# 全局生命周期管理器配置
lifecycle_manager:
  ros__parameters:
    autostart: true
    node_names: ['controller_server', 'planner_server', 'behavior_server', 'bt_navigator', 'waypoint_follower', 'amcl']

# AMCL 定位服务器配置
amcl:
  ros__parameters:
    # 【需修改】设置你的机器人坐标系
    base_frame_id: "base_link"
    odom_frame_id: "odom"
    global_frame_id: "map"
    use_sim_time: false

    # 粒子滤波器参数 (可调整)
    min_particles: 500
    max_particles: 3000
    # 【需修改】设置你激光雷达的话题名
    scan_topic: "scan"

# 行为树导航器配置
bt_navigator:
  ros__parameters:
    global_frame: "map"
    robot_base_frame: "base_link"
    odom_topic: "odom"
    use_sim_time: false

# 控制器服务器 (负责路径跟踪和局部避障)
controller_server:
  ros__parameters:
    use_sim_time: false
    # 【需修改】设置你机器人底盘的帧ID
    frame_id: "base_link"

    # 指定使用的插件 (这里使用默认的DWB控制器)
    controller_plugins: ["FollowPath"]

    FollowPath:
      plugin: "dwb_core::DWBLocalPlanner"
      # 【需修改】设置你机器人底盘的帧ID， 并检查话题名
      robot_base_frame: "base_link"
      odom_topic: "odom"
      # 发布速度命令的话题， 需与你的底盘驱动订阅的话题一致
      cmd_vel_topic: "cmd_vel"

      # DWB规划器的具体参数 (可根据机器人性能调整)
      min_vel_x: -0.1
      max_vel_x: 0.3
      min_vel_theta: -0.5
      max_vel_theta: 0.5

# 规划器服务器 (负责全局路径规划)
planner_server:
  ros__parameters:
    use_sim_time: false
    expected_planner_frequency: 1.0
    planner_plugins: ["GridBased"]
    GridBased:
      plugin: "nav2_navfn_planner/NavfnPlanner"
      tolerance: 0.5

# 行为服务器 (负责恢复行为，如清除代价地图、旋转)
behavior_server:
  ros__parameters:
    use_sim_time: false
    behavior_plugins: ["spin", "wait", "backup", "clear_costmap_service"]
    # ... 各行为参数

# 全局与局部代价地图配置 (定义障碍物信息源和地图大小)
global_costmap:
  global_costmap:
    ros__parameters:
      use_sim_time: false
      global_frame: "map"
      robot_base_frame: "base_link"
      update_frequency: 1.0
      publish_frequency: 1.0
      # 【需修改】设置你激光雷达的话题名， 作为障碍物源
      observation_sources: "scan"
      scan:
        data_type: "LaserScan"
        topic: "scan"
        marking: true
        clearing: true

local_costmap:
  local_costmap:
    ros__parameters:
      use_sim_time: false
      global_frame: "odom"
      robot_base_frame: "base_link"
      update_frequency: 5.0
      publish_frequency: 2.0
      width: 3.0
      height: 3.0
      # 【需修改】设置你激光雷达的话题名
      observation_sources: "scan"
      scan:
        data_type: "LaserScan"
        topic: "scan"
        marking: true
        clearing: true